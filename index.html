<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đề Kiểm Tra Toán 11 Cuối Kỳ 1</title>
    <style>
        :root {
            --primary: #007bff;
            --success: #28a745;
            --danger: #dc3545;
            --bg: #f4f6f9;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; }
        
        /* HEADER & TIMER */
        .header {
            position: sticky; top: 0; background: white; padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 3px solid var(--primary);
        }
        .timer {
            font-size: 1.4rem; font-weight: bold; color: var(--danger);
            background: #fff0f0; padding: 5px 15px; border-radius: 5px; border: 1px solid var(--danger);
        }

        /* CONTAINER */
        .container { max-width: 900px; margin: 20px auto; background: white; padding: 40px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        h1 { text-align: center; color: var(--primary); margin-bottom: 5px; }
        .sub-head { text-align: center; color: #666; margin-bottom: 30px; }

        /* SECTIONS */
        .part-title { background: #e9ecef; padding: 10px 15px; margin: 30px 0 20px; border-left: 5px solid var(--primary); font-weight: bold; border-radius: 4px; }
        
        /* QUESTIONS */
        .q-block { margin-bottom: 25px; padding: 20px; border: 1px solid #dee2e6; border-radius: 8px; }
        .q-text { font-weight: 600; margin-bottom: 15px; display: block; font-size: 1.05rem; }
        
        /* TABLES */
        table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 0.95rem; }
        th, td { border: 1px solid #ccc; padding: 8px 15px; text-align: center; }
        th { background: #f8f9fa; }

        /* MC OPTIONS */
        .mc-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .mc-label { display: flex; padding: 10px; border: 1px solid #ced4da; border-radius: 5px; cursor: pointer; align-items: center; }
        .mc-label:hover { background: #f8f9fa; }
        input[type="radio"] { margin-right: 10px; transform: scale(1.2); }

        /* TRUE/FALSE GRID */
        .tf-row { display: grid; grid-template-columns: 1fr 80px 80px; gap: 10px; padding: 10px 0; border-bottom: 1px solid #eee; align-items: center; }
        .tf-header { font-weight: bold; background: #f1f1f1; }

        /* SHORT ANSWER */
        .short-input { width: 100%; max-width: 300px; padding: 10px; border: 2px solid #ced4da; border-radius: 5px; font-size: 1rem; }

        /* FEEDBACK */
        .explanation { display: none; margin-top: 15px; padding: 15px; background: #fff3cd; border-left: 4px solid #ffc107; font-size: 0.9rem; }
        .correct-border { border-color: var(--success); background: #d4edda; }
        .wrong-border { border-color: var(--danger); background: #f8d7da; }

        /* RESULT BOARD */
        #result-board { display: none; text-align: center; background: #d1e7dd; padding: 20px; border: 2px solid var(--success); border-radius: 8px; margin-bottom: 20px; }
        .score-big { font-size: 2.5rem; font-weight: bold; color: var(--success); }

        /* FOOTER */
        .footer { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 15px; text-align: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        .btn-submit { background: var(--primary); color: white; padding: 12px 40px; border: none; border-radius: 30px; font-size: 1.2rem; font-weight: bold; cursor: pointer; }
        .btn-submit:hover { background: #0056b3; }
    </style>
</head>
<body>

    <div class="header">
        <div><strong>TOÁN 11 - HK1</strong></div>
        <div class="timer" id="timer">60:00</div>
    </div>

    <div class="container">
        <h1>ĐỀ KIỂM TRA CUỐI KỲ 1</h1>
        <div class="sub-head">Thời gian làm bài: 60 phút</div>

        <div id="result-board">
            <h2>KẾT QUẢ BÀI LÀM</h2>
            <div class="score-big" id="final-score">0.0</div>
            <p>Điểm thang 10</p>
        </div>

        <form id="quiz-form">
            <div class="part-title">PHẦN I. TRẮC NGHIỆM (3.0 điểm - Mỗi câu 0.3đ)</div>

            <div class="q-block" id="q1">
                <span class="q-text">Câu 1: Công thức lượng giác nào sau đây là ĐÚNG?</span>
                <div class="mc-options">
                    <label class="mc-label"><input type="radio" name="p1q1" value="A"> A. sin(a + b) = sin a cos b + cos a sin b</label>
                    <label class="mc-label"><input type="radio" name="p1q1" value="B"> B. sin(a + b) = sin a cos b - cos a sin b</label>
                    <label class="mc-label"><input type="radio" name="p1q1" value="C"> C. cos(a + b) = cos a cos b + sin a sin b</label>
                    <label class="mc-label"><input type="radio" name="p1q1" value="D"> D. tan(a + b) = (tan a - tan b)/(1 + tan a tan b)</label>
                </div>
                <div class="explanation"><strong>Đáp án A.</strong> Công thức cộng sin: sin thì sin cos cos sin, dấu cùng.</div>
            </div>

            <div class="q-block" id="q2">
                <span class="q-text">Câu 2: Nghiệm của phương trình lượng giác 2cos(x) - 1 = 0 là:</span>
                <div class="mc-options">
                    <label class="mc-label"><input type="radio" name="p1q2" value="A"> A. x = ±π/3 + k2π</label>
                    <label class="mc-label"><input type="radio" name="p1q2" value="B"> B. x = ±π/6 + k2π</label>
                    <label class="mc-label"><input type="radio" name="p1q2" value="C"> C. x = π/3 + k2π</label>
                    <label class="mc-label"><input type="radio" name="p1q2" value="D"> D. x = ±π/3 + kπ</label>
                </div>
                <div class="explanation"><strong>Đáp án A.</strong> cos x = 1/2 = cos(π/3) ⇒ x = ±π/3 + k2π.</div>
            </div>

            <div class="q-block" id="q3">
                <span class="q-text">Câu 3: Cho dãy số (uₙ) là cấp số cộng có u₁ = -2 và công sai d = 3. Số hạng u₁₀ bằng bao nhiêu?</span>
                <div class="mc-options">
                    <label class="mc-label"><input type="radio" name="p1q3" value="A"> A. 28</label>
                    <label class="mc-label"><input type="radio" name="p1q3" value="B"> B. 25</label>
                    <label class="mc-label"><input type="radio" name="p1q3" value="C"> C. -29</label>
                    <label class="mc-label"><input type="radio" name="p1q3" value="D"> D. 32</label>
                </div>
                <div class="explanation"><strong>Đáp án B.</strong> u₁₀ = u₁ + 9d = -2 + 9(3) = 25.</div>
            </div>

            <div class="q-block" id="q4">
                <span class="q-text">Câu 4: Cho cấp số nhân (uₙ) có u₁ = 3, q = -2. Tìm số hạng thứ 5.</span>
                <div class="mc-options">
                    <label class="mc-label"><input type="radio" name="p1q4" value="A"> A. 48</label>
                    <label class="mc-label"><input type="radio" name="p1q4" value="B"> B. -48</label>
                    <label class="mc-label"><input type="radio" name="p1q4" value="C"> C. -96</label>
                    <label class="mc-label"><input type="radio" name="p1q4" value="D"> D. 24</label>
                </div>
                <div class="explanation"><strong>Đáp án A.</strong> u₅ = u₁ * q⁴ = 3 * (-2)⁴ = 3 * 16 = 48.</div>
            </div>

            <div class="q-block" id="q5">
                <span class="q-text">Câu 5: Giá trị của giới hạn lim (2n² + 3n)/(n² - 1) là:</span>
                <div class="mc-options">
                    <label class="mc-label"><input type="radio" name="p1q5" value="A"> A. 2</label>
                    <label class="mc-label"><input type="radio" name="p1q5" value="B"> B. 0</label>
                    <label class="mc-label"><input type="radio" name="p1q5" value="C"> C. 3</label>
                    <label class="mc-label"><input type="radio" name="p1q5" value="D"> D. +∞</label>
                </div>
                <div class="explanation"><strong>Đáp án A.</strong> Bậc tử = bậc mẫu, lấy hệ số cao nhất chia nhau: 2/1 = 2.</div>
            </div>

            <div class="q-block" id="q6">
                <span class="q-text">Câu 6: Giới hạn lim(x→1) của (x² + x - 2)/(x - 1) bằng:</span>
                <div class="mc-options">
                    <label class="mc-label"><input type="radio" name="p1q6" value="A"> A. 0</label>
                    <label class="mc-label"><input type="radio" name="p1q6" value="B"> B. 1</label>
                    <label class="mc-label"><input type="radio" name="p1q6" value="C"> C. 3</label>
                    <label class="mc-label"><input type="radio" name="p1q6" value="D"> D. 2</label>
                </div>
                <div class="explanation"><strong>Đáp án C.</strong> (x-1)(x+2)/(x-1) = x+2. Thay x=1 vào được 3.</div>
            </div>

            <div class="q-block" id="q7">
                <span class="q-text">Câu 7: Khẳng định nào sau đây ĐÚNG khi nói về đường thẳng song song với mặt phẳng?</span>
                <div class="mc-options">
                    <label class="mc-label"><input type="radio" name="p1q7" value="A"> A. Nếu d // (α) thì d // mọi đường thẳng trong (α).</label>
                    <label class="mc-label"><input type="radio" name="p1q7" value="B"> B. Nếu d // (α) thì trong (α) có ít nhất một đường thẳng // d.</label>
                    <label class="mc-label"><input type="radio" name="p1q7" value="C"> C. Nếu d // a và a ⊂ (α) thì d // (α).</label>
                    <label class="mc-label"><input type="radio" name="p1q7" value="D"> D. Nếu d ∩ (α) = ∅ thì d vuông góc với (α).</label>
                </div>
                <div class="explanation"><strong>Đáp án B.</strong> Định lý cơ bản. A sai vì d chéo nhau với đa số đường. C sai vì d có thể nằm trong (α). D sai.</div>
            </div>

            <div class="q-block" id="q8">
                <span class="q-text">Câu 8: Cho hai mặt phẳng song song (P) và (Q). Một mặt phẳng (R) cắt (P) theo giao tuyến a và cắt (Q) theo giao tuyến b. Khi đó:</span>
                <div class="mc-options">
                    <label class="mc-label"><input type="radio" name="p1q8" value="A"> A. a trùng b</label>
                    <label class="mc-label"><input type="radio" name="p1q8" value="B"> B. a cắt b</label>
                    <label class="mc-label"><input type="radio" name="p1q8" value="C"> C. a song song b</label>
                    <label class="mc-label"><input type="radio" name="p1q8" value="D"> D. a chéo b</label>
                </div>
                <div class="explanation"><strong>Đáp án C.</strong> Định lý giao tuyến của 3 mặt phẳng (khi 2 mp song song).</div>
            </div>

            <div class="q-block" id="q9">
                <span class="q-text">Câu 9: Cho bảng tần số ghép nhóm sau. Nhóm nào chứa Mốt?</span>
                <table>
                    <tr><th>Nhóm</th><th>[10; 20)</th><th>[20; 30)</th><th>[30; 40)</th><th>[40; 50)</th><th>[50; 60)</th></tr>
                    <tr><th>Tần số</th><td>8</td><td>15</td><td>25</td><td>18</td><td>10</td></tr>
                </table>
                <div class="mc-options">
                    <label class="mc-label"><input type="radio" name="p1q9" value="A"> A. [20; 30)</label>
                    <label class="mc-label"><input type="radio" name="p1q9" value="B"> B. [30; 40)</label>
                    <label class="mc-label"><input type="radio" name="p1q9" value="C"> C. [40; 50)</label>
                    <label class="mc-label"><input type="radio" name="p1q9" value="D"> D. [50; 60)</label>
                </div>
                <div class="explanation"><strong>Đáp án B.</strong> Nhóm [30; 40) có tần số lớn nhất là 25.</div>
            </div>

            <div class="q-block" id="q10">
                <span class="q-text">Câu 10: Hàm số y = f(x) liên tục tại x₀ khi và chỉ khi:</span>
                <div class="mc-options">
                    <label class="mc-label"><input type="radio" name="p1q10" value="A"> A. Lim x→x₀ f(x) = f(x₀)</label>
                    <label class="mc-label"><input type="radio" name="p1q10" value="B"> B. Lim x→x₀ f(x) = 0</label>
                    <label class="mc-label"><input type="radio" name="p1q10" value="C"> C. f(x₀) xác định</label>
                    <label class="mc-label"><input type="radio" name="p1q10" value="D"> D. Lim x→x₀+ f(x) ≠ Lim x→x₀- f(x)</label>
                </div>
                <div class="explanation"><strong>Đáp án A.</strong> Định nghĩa hàm số liên tục.</div>
            </div>

            <div class="part-title">PHẦN II. TRẮC NGHIỆM ĐÚNG SAI (4.0 điểm)</div>
            <p><i>Mỗi câu hỏi có 4 ý. Chọn Đúng hoặc Sai cho từng ý. Quy tắc chấm điểm: 1 ý đúng: 0.1đ; 2 ý: 0.25đ; 3 ý: 0.5đ; 4 ý: 1.0đ.</i></p>

            <div class="q-block" id="q11">
                <span class="q-text">Câu 11: Cho phương trình lượng giác: cos(2x) + sin(x) = 0.</span>
                <div class="tf-row tf-header"><div>Mệnh đề</div><div>Đúng</div><div>Sai</div></div>
                <div class="tf-row">
                    <div>a) Phương trình tương đương với: 2sin²x - sin x - 1 = 0.</div>
                    <div><input type="radio" name="p2q11a" value="T"></div><div><input type="radio" name="p2q11a" value="F"></div>
                </div>
                <div class="tf-row">
                    <div>b) Phương trình có các nghiệm là x = π/2 + k2π và x = -π/6 + k2π.</div>
                    <div><input type="radio" name="p2q11b" value="T"></div><div><input type="radio" name="p2q11b" value="F"></div>
                </div>
                <div class="tf-row">
                    <div>c) Trên đoạn [0; π], phương trình có đúng 1 nghiệm.</div>
                    <div><input type="radio" name="p2q11c" value="T"></div><div><input type="radio" name="p2q11c" value="F"></div>
                </div>
                <div class="tf-row">
                    <div>d) Tổng các nghiệm thuộc khoảng (0; 2π) của phương trình là 3π.</div>
                    <div><input type="radio" name="p2q11d" value="T"></div><div><input type="radio" name="p2q11d" value="F"></div>
                </div>
                <div class="explanation">
                    <strong>Giải thích:</strong><br>
                    a) <strong>Đúng</strong>. 1-2sin²x + sinx = 0 ⇔ 2sin²x - sinx - 1 = 0.<br>
                    b) <strong>Sai</strong>. Nghiệm là sinx=1 (π/2+k2π) và sinx=-1/2 (-π/6+k2π và 7π/6+k2π).<br>
                    c) <strong>Đúng</strong>. Trên [0; π] chỉ có nghiệm π/2. (Nghiệm sin=-1/2 âm hoặc >π).<br>
                    d) <strong>Sai</strong>. Nghiệm trong (0; 2π) là π/2, 7π/6, 11π/6. Tổng = 3π + π/2 = 3.5π.
                </div>
            </div>

            <div class="q-block" id="q12">
                <span class="q-text">Câu 12: Cho hình chóp S.ABCD có đáy ABCD là hình bình hành tâm O. Gọi M, N lần lượt là trung điểm của SA và CD.</span>
                <div class="q-text" style="font-weight: normal; font-style: italic; font-size: 0.9rem;">(Học sinh vẽ hình nháp để trả lời)</div>
                <div class="tf-row tf-header"><div>Mệnh đề</div><div>Đúng</div><div>Sai</div></div>
                <div class="tf-row">
                    <div>a) Đường thẳng OM song song với mặt phẳng (SCD).</div>
                    <div><input type="radio" name="p2q12a" value="T"></div><div><input type="radio" name="p2q12a" value="F"></div>
                </div>
                <div class="tf-row">
                    <div>b) Đường thẳng MN cắt mặt phẳng (SBD).</div>
                    <div><input type="radio" name="p2q12b" value="T"></div><div><input type="radio" name="p2q12b" value="F"></div>
                </div>
                <div class="tf-row">
                    <div>c) Giao tuyến của hai mặt phẳng (SAC) và (SBD) là đường thẳng SO.</div>
                    <div><input type="radio" name="p2q12c" value="T"></div><div><input type="radio" name="p2q12c" value="F"></div>
                </div>
                <div class="tf-row">
                    <div>d) Thiết diện của hình chóp cắt bởi mặt phẳng (MNC) là hình thang.</div>
                    <div><input type="radio" name="p2q12d" value="T"></div><div><input type="radio" name="p2q12d" value="F"></div>
                </div>
                <div class="explanation">
                    <strong>Giải thích:</strong><br>
                    a) <strong>Đúng</strong>. OM là đường trung bình tam giác SAC => OM // SC. Mà SC nằm trong (SCD).<br>
                    b) <strong>Đúng</strong>. N nằm trên CD, M trên SA. MN xuyên qua khối chóp cắt mp chéo SBD.<br>
                    c) <strong>Đúng</strong>. S là điểm chung, O là tâm đáy (giao AC, BD).<br>
                    d) <strong>Đúng</strong>. (MNC) chứa CD. Giao tuyến với (SAB) đi qua M và // CD // AB. Tứ giác có cặp cạnh // là hình thang.
                </div>
            </div>

            <div class="q-block" id="q13">
                <span class="q-text">Câu 13: Cho bảng số liệu về doanh thu bán hàng (triệu đồng) của 50 chi nhánh trong một tháng:</span>
                <table>
                    <tr><th>Doanh thu</th><th>[100; 120)</th><th>[120; 140)</th><th>[140; 160)</th><th>[160; 180)</th><th>[180; 200)</th></tr>
                    <tr><th>Số chi nhánh</th><td>5</td><td>10</td><td>20</td><td>10</td><td>5</td></tr>
                </table>
                <div class="tf-row tf-header"><div>Mệnh đề</div><div>Đúng</div><div>Sai</div></div>
                <div class="tf-row">
                    <div>a) Kích thước mẫu là N = 50.</div>
                    <div><input type="radio" name="p2q13a" value="T"></div><div><input type="radio" name="p2q13a" value="F"></div>
                </div>
                <div class="tf-row">
                    <div>b) Nhóm chứa trung vị là nhóm [160; 180).</div>
                    <div><input type="radio" name="p2q13b" value="T"></div><div><input type="radio" name="p2q13b" value="F"></div>
                </div>
                <div class="tf-row">
                    <div>c) Doanh thu trung bình của các chi nhánh là 150 triệu đồng.</div>
                    <div><input type="radio" name="p2q13c" value="T"></div><div><input type="radio" name="p2q13c" value="F"></div>
                </div>
                <div class="tf-row">
                    <div>d) Có 30% số chi nhánh có doanh thu từ 160 triệu đồng trở lên.</div>
                    <div><input type="radio" name="p2q13d" value="T"></div><div><input type="radio" name="p2q13d" value="F"></div>
                </div>
                <div class="explanation">
                    <strong>Giải thích:</strong><br>
                    a) <strong>Đúng</strong>. 5+10+20+10+5 = 50.<br>
                    b) <strong>Sai</strong>. N/2 = 25. Tần số tích lũy: 5, 15, 35. Vị trí 25 thuộc nhóm [140; 160).<br>
                    c) <strong>Đúng</strong>. Do phân phối đối xứng hoàn hảo qua nhóm giữa [140;160), trung bình là tâm nhóm này: 150.<br>
                    d) <strong>Đúng</strong>. (10 + 5) / 50 = 15/50 = 30%.
                </div>
            </div>

            <div class="part-title">PHẦN III. TRẢ LỜI NGẮN (3.0 điểm - Mỗi câu 1.0đ)</div>
            
            <div class="q-block" id="q14">
                <span class="q-text">Câu 14 (Toán thực tế):</span>
                <p>Một quả bóng được thả rơi từ độ cao 100m. Mỗi lần chạm đất, bóng nảy lên được 1/2 độ cao của lần rơi trước đó. Giả sử bóng nảy mãi mãi. Tính tổng quãng đường bóng di chuyển (cả lên và xuống) cho đến khi dừng hẳn? (Kết quả tính bằng mét).</p>
                <input type="number" class="short-input" id="p3q14" placeholder="Nhập số...">
                <div class="explanation">
                    <strong>Đáp án: 300</strong><br>
                    Đây là tổng CSN lùi vô hạn. S = h_đầu + 2 * (h_nảy_1 + ...).<br>
                    Công thức nhanh: S = H * (1+q)/(1-q) = 100 * (1.5 / 0.5) = 300m.
                </div>
            </div>

            <div class="q-block" id="q15">
                <span class="q-text">Câu 15 (Thống kê):</span>
                <p>Dựa vào bảng số liệu ở Câu 13 (Phần 2), hãy tính Mốt (M₀) của mẫu số liệu. (Làm tròn đến hàng đơn vị).</p>
                <input type="number" class="short-input" id="p3q15" placeholder="Nhập số...">
                <div class="explanation">
                    <strong>Đáp án: 150</strong><br>
                    Nhóm mốt [140; 160). u=140, n=20, n1=10, n2=10, h=20.<br>
                    Mo = 140 + ((20-10)/((20-10)+(20-10))) * 20 = 140 + (10/20)*20 = 150.
                </div>
            </div>

            <div class="q-block" id="q16">
                <span class="q-text">Câu 16 (Hình học):</span>
                <p>Cho hình chóp S.ABCD có đáy là hình bình hành. Một mặt phẳng (P) song song với mặt phẳng (ABCD) cắt các cạnh SA, SB, SC, SD lần lượt tại A', B', C', D'. Biết thể tích khối chóp S.A'B'C'D' bằng 1/8 thể tích khối chóp S.ABCD. Tính tỉ số SA'/SA?</p>
                <input type="text" class="short-input" id="p3q16" placeholder="Nhập phân số a/b hoặc số thập phân...">
                <div class="explanation">
                    <strong>Đáp án: 1/2 (hoặc 0.5)</strong><br>
                    Hai hình chóp đồng dạng. Tỉ số thể tích bằng lập phương tỉ số đồng dạng k.<br>
                    k³ = V'/V = 1/8 => k = 1/2.
                </div>
            </div>

        </form>

        <div class="footer">
            <button type="button" class="btn-submit" onclick="submitExam()">NỘP BÀI & XEM ĐIỂM</button>
        </div>
    </div>

    <script>
        // DATA ĐÁP ÁN
        const answers = {
            // Phần 1
            p1q1: "A", p1q2: "A", p1q3: "B", p1q4: "A", p1q5: "A",
            p1q6: "C", p1q7: "B", p1q8: "C", p1q9: "B", p1q10: "A",
            // Phần 2 (T: True, F: False)
            p2q11a: "T", p2q11b: "F", p2q11c: "T", p2q11d: "F",
            p2q12a: "T", p2q12b: "T", p2q12c: "T", p2q12d: "T",
            p2q13a: "T", p2q13b: "F", p2q13c: "T", p2q13d: "T",
            // Phần 3
            p3q14: ["300"],
            p3q15: ["150"],
            p3q16: ["1/2", "0.5", "0,5"]
        };

        // TIMER LOGIC
        let timeLeft = 3600; // 60 minutes
        const timerEl = document.getElementById('timer');
        
        const countdown = setInterval(() => {
            let m = Math.floor(timeLeft / 60);
            let s = timeLeft % 60;
            timerEl.textContent = `${m}:${s < 10 ? '0' : ''}${s}`;
            timeLeft--;
            
            if (timeLeft < 0) {
                clearInterval(countdown);
                submitExam();
                alert("Hết giờ làm bài!");
            }
        }, 1000);

        // GRADING LOGIC
        function submitExam() {
            clearInterval(countdown);
            let totalScore = 0;

            // --- Chấm Phần 1 (10 câu, 0.3đ/câu) ---
            for (let i = 1; i <= 10; i++) {
                const qKey = `p1q${i}`;
                const userAns = document.querySelector(`input[name="${qKey}"]:checked`)?.value;
                const block = document.getElementById(`q${i}`);
                
                if (userAns === answers[qKey]) {
                    totalScore += 0.3;
                    block.classList.add('correct-border');
                } else {
                    block.classList.add('wrong-border');
                }
            }

            // --- Chấm Phần 2 (3 câu, mỗi câu max 1.0đ theo quy tắc số ý đúng) ---
            const p2Questions = ['q11', 'q12', 'q13'];
            p2Questions.forEach(q => {
                let correctCount = 0;
                ['a', 'b', 'c', 'd'].forEach(sub => {
                    const key = `p2${q}${sub}`;
                    const val = document.querySelector(`input[name="${key}"]:checked`)?.value;
                    if (val === answers[key]) correctCount++;
                });

                // Quy tắc điểm mới: 1ý=0.1, 2ý=0.25, 3ý=0.5, 4ý=1.0
                let points = 0;
                if (correctCount === 1) points = 0.1;
                else if (correctCount === 2) points = 0.25;
                else if (correctCount === 3) points = 0.5;
                else if (correctCount === 4) points = 1.0;
                
                totalScore += points;
                
                const block = document.getElementById(q);
                if (correctCount === 4) block.classList.add('correct-border');
                else block.classList.add('wrong-border');
            });

            // --- Chấm Phần 3 (3 câu, 1.0đ/câu) ---
            const p3Questions = ['p3q14', 'p3q15', 'p3q16'];
            p3Questions.forEach((key, index) => {
                const userVal = document.getElementById(key).value.trim();
                const qNum = 14 + index;
                const block = document.getElementById(`q${qNum}`);
                
                // Check if user answer is in the array of accepted answers
                if (answers[key].includes(userVal)) {
                    totalScore += 1.0;
                    block.classList.add('correct-border');
                } else {
                    block.classList.add('wrong-border');
                }
            });

            // --- Hiển thị kết quả ---
            document.getElementById('final-score').textContent = totalScore.toFixed(2);
            document.getElementById('result-board').style.display = 'block';
            
            // Hiện lời giải
            document.querySelectorAll('.explanation').forEach(el => el.style.display = 'block');
            
            // Disable inputs
            document.querySelectorAll('input').forEach(el => el.disabled = true);
            document.querySelector('.btn-submit').style.display = 'none';

            // Scroll to top
            window.scrollTo(0, 0);
        }
    </script>
</body>
</html>
